module.exports = {
  name: "rankamante",
  description: "Mostra o ranking dos 5 maiores amantes do grupo",
  commands: ["rankamante"],
  usage: "!rankamante",

  /**
   * @param {import('../../@types').CommandHandleProps} props
   */
  handle: async ({ socket, webMessage, sendReply }) => {
    
    // 1. Garante que √© um grupo
    if (!webMessage.key.remoteJid.endsWith('@g.us')) {
      return await sendReply('‚ú® ‚ùå Esse comando s√≥ funciona em grupos, amante!');
    }
    
    try {
      // 2. BUSCA ROBUSTA DOS METADADOS
      const grupoInfo = await socket.groupMetadata(webMessage.key.remoteJid);

      const membros = grupoInfo.participants
        .filter((m) => !m.id.endsWith("g.us") && !m.id.includes("broadcast"))
        .map((m) => m.id);

      if (membros.length < 5) {
        return await sendReply("‚ú® ‚ùå Poucos membros no grupo para formar o rank dos amantes.");
      }

      const frases = [
        "Esse a√≠ seduz at√© digitando 'oi'... cuidado!",
        "Amante profissional, tem at√© crach√°!",
        "Deixa qualquer um apaixonado s√≥ com o bom dia.",
        "Rom√¢ntico, pegador e cafajeste na medida certa.",
        "Quem nunca caiu no papo desse a√≠, que atire o primeiro emoji.",
        "Tem mais contatinho que a agenda do Neymar.",
        "Tem fama de fiel... mas s√≥ fama mesmo.",
        "Quando ama, ama forte... o problema √© que ama todo mundo.",
        "Beija com gosto, mas some depois.",
        "O tipo que manda 'voc√™ merece mais' depois de trair."
      ];

      const conselhos = [
        "üíò Conquistar √© f√°cil, dif√≠cil √© manter o mist√©rio.",
        "üí¨ Amante bom sabe sair antes de ser descoberto.",
        "üíã Cuidado, quem ama demais acaba ficando solteiro.",
        "‚ù§Ô∏è O segredo de um bom amante √© saber sumir na hora certa.",
        "üëÄ Se apaixonar por amante d√° processo emocional!"
      ];

      // Sorteia e pega os top 5 JIDs
      const embaralhados = membros.sort(() => 0.5 - Math.random()).slice(0, 5);

      let mensagem = "üíã *RANK DOS 5 MAIORES AMANTES DO GRUPO!*\n‚Äî\n";

      // 3. Montagem da Mensagem (CORRE√á√ÉO na men√ß√£o: usa o ID do participante)
      embaralhados.forEach((id, index) => {
        const numero = id.split("@")[0]; // O n√∫mero puro
        const porcentagem = Math.floor(Math.random() * 100) + 1;
        const frase = frases[Math.floor(Math.random() * frases.length)];

        // Usa o n√∫mero do ID para a men√ß√£o
        mensagem += `üíã ${index + 1}¬∞ *[${porcentagem}%]* - @${numero} -> (${frase})\n`; 
      });

      const conselhoFinal = conselhos[Math.floor(Math.random() * conselhos.length)];
      mensagem += `\nüß† *Conselho de amante:* ${conselhoFinal}`;

      // 4. Envio da Mensagem com Men√ß√µes
      await socket.sendMessage(webMessage.key.remoteJid, {
        text: mensagem,
        mentions: embaralhados, // Array de JIDs
      });

    } catch (e) {
      console.error("Erro no comando !rankamante:", e);
      await sendReply("‚ú® ‚ùå Erro ao gerar o rank dos amantes.");
    }
  },
};