const { PREFIX } = require(`${BASE_DIR}/config`);
const { 
  activateRealGroup, 
  deactivateRealGroup,
  isActiveRealGroup // Importa para checagem interna de status
} = require(`${BASE_DIR}/utils/database`);

// JIDs FIXOS PARA O DONO: Chave mestra do seu sistema de economia (Obrigat√≥rio para comandos de controle)
const TARGET_JID_DONO = '240041947357401@lid'; 
const DONO_PHONE = '556391330669@s.whatsapp.net';

module.exports = {
  name: "modoreal",
  description: "Ativa ou desativa o sistema de Real (economia) no grupo. Comando de Dono.",
  commands: ["modoreal"],
  usage: `${PREFIX}modoreal 1 ou ${PREFIX}modoreal 0`,
  
  /**
   * @param {CommandHandleProps} props
   * @returns {Promise<void>}
   */
  handle: async ({ remoteJid, userJid, args, sendReply }) => {
    
    // 1. CHECAGEM DE DONO (Corrigida)
    const isOwner = userJid.includes(DONO_PHONE) || userJid.includes(TARGET_JID_DONO);
    if (!isOwner) {
        return sendReply("üö® Comando restrito. Apenas meu dono *Leandro* pode controlar o modo real.");
    }

    // 2. Valida√ß√£o da A√ß√£o
    const actionStr = String(args || '').trim().split(/\s+/)[0];
    const statusAtual = isActiveRealGroup(remoteJid);

    if (actionStr === '1') {
        if (statusAtual) {
             return sendReply("‚ÑπÔ∏è O Modo Real j√° est√° *ATIVADO* neste grupo.");
        }
        // Ativar o modo real
        activateRealGroup(remoteJid);
        
        await sendReply(`
‚úÖ *MODO REAL ATIVADO!*
---------------------------------
O sistema de Real (R$) agora est√° ativo neste grupo.
Membros podem usar comandos de economia.
        `.trim());

    } else if (actionStr === '0') {
        if (!statusAtual) {
             return sendReply("‚ÑπÔ∏è O Modo Real j√° est√° *DESATIVADO* neste grupo.");
        }
        // Desativar o modo real
        deactivateRealGroup(remoteJid);
        
        await sendReply(`
‚ùå *MODO REAL DESATIVADO!*
---------------------------------
O sistema de Real (R$) foi desativado neste grupo.
Comandos de economia n√£o funcionar√£o mais.
        `.trim());

    } else {
        // Argumento inv√°lido ou ausente
        const statusMsg = statusAtual ? "ATIVADO" : "DESATIVADO";
        await sendReply(`
‚ö†Ô∏è *Argumento Inv√°lido ou Ausente!*
---------------------------------
Status Atual: *${statusMsg}*
Use:
- ${PREFIX}modoreal *1* para ativar o modo real.
- ${PREFIX}modoreal *0* para desativar o modo real.
        `.trim());
    }
  },
};